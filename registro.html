<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro de Grupos</title>
  <link rel="stylesheet" href="estilos.css" />
</head>
<body>
    <div style="text-align: right;">
    <button onclick="window.history.back()" style="border: none; background: none; font-size: 1.5rem; cursor: pointer;">‚úï</button>
  </div>

  <h2>Registro de Grupo</h2>

  <label for="numeroNegocio">N√∫mero de Negocio</label>
  <input list="negocioList" id="numeroNegocio" name="numeroNegocio" />
  <datalist id="negocioList"></datalist>

  <div class="row">
    <div class="column">
      <label for="nombreGrupo">Nombre de Grupo</label>
      <input id="nombreGrupo" name="nombreGrupo" type="text" />
    </div>
    <div class="column">
      <label for="cantidadgrupo">Cantidad Grupo</label>
      <input id="cantidadgrupo" name="cantidadgrupo" type="number" />
    </div>
  </div>

  <label for="colegio">Colegio</label>
  <input id="colegio" name="colegio" type="text" />

  <div class="row">
    <div class="column">
      <label for="curso">Curso</label>
      <input id="curso" name="curso" type="text" />
    </div>
    <div class="column">
      <label for="anoViaje">A√±o Viaje</label>
      <input id="anoViaje" name="anoViaje" type="text" />
    </div>
  </div>

  <div class="row">
    <div class="column">
      <label for="destino">Destino</label>
      <input id="destino" name="destino" type="text" />
    </div>
    <div class="column">
      <label for="programa">Programa</label>
      <input id="programa" name="programa" type="text" />
    </div>
    <div class="column">
      <label for="hotel">Hotel</label>
      <input id="hotel" name="hotel" type="text" />
    </div>
  </div>

  <label for="asistenciaEnViajes">Asistencia M√©dica</label>
  <input id="asistenciaEnViajes" name="asistenciaEnViajes" type="text" />

  <label for="autorizacion">Autorizaci√≥n (observaciones)</label>
  <textarea id="autorizacion" name="autorizacion" rows="3"></textarea>

  <label for="fechaDeViaje">Fecha de Viaje (observaciones)</label>
  <textarea id="fechaDeViaje" name="fechaDeViaje" rows="3"></textarea>

  <label for="observaciones">Informaci√≥n para operaciones</label>
  <textarea id="observaciones" name="observaciones" rows="3"></textarea>

  <label for="text1">Versi√≥n Ficha</label>
  <input id="text1" name="versionFicha" type="text" />

  <div class="button-container">
    <button onclick="guardarYVolver()">Guardar y Volver</button>
    <button onclick="guardarDatos(true)">Guardar y Continuar</button>
  </div>

  <script>
  const sheetURL = 'https://script.google.com/macros/s/AKfycbzuyexFe0dUTBNtRLPL9NDdt8-elJH5gk2O_yb0vsdpTWTgx_E0R0UnPsIGzRhzTjf1JA/exec';

  const campos = {
    numeroNegocio: 'numeroNegocio',
    nombreGrupo: 'nombreGrupo',
    cantidadgrupo: 'cantidadgrupo', // ‚úÖ aseg√∫rate que coincida con el ID en el HTML
    colegio: 'colegio',
    curso: 'curso',
    anoViaje: 'anoViaje',
    destino: 'destino',
    programa: 'programa',
    hotel: 'hotel',
    asistenciaEnViajes: 'asistenciaEnViajes',
    autorizacion: 'autorizacion',
    fechaDeViaje: 'fechaDeViaje',
    observaciones: 'observaciones',
    versionFicha: 'text1'
  };

  Object.values(campos).forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.addEventListener("input", e => {
        e.target.value = e.target.value.toUpperCase();
      });
    }
  });

  async function cargarNumeroNegocio() {
    const res = await fetch(sheetURL);
    const datos = await res.json();
    const lista = document.getElementById("negocioList");

    // üîÑ Llenar dropdown
    datos.forEach(fila => {
      if (fila.numeroNegocio) {
        const opt = document.createElement("option");
        opt.value = fila.numeroNegocio;
        lista.appendChild(opt);
      }
    });

    const inputNegocio = document.getElementById("numeroNegocio"); // üü¢ ¬°Esto faltaba!

    function cargarDatosGrupo() {
      const fila = datos.find(r => r.numeroNegocio === inputNegocio.value);
      console.log("Fila encontrada (campos reales):", Object.keys(fila));
      if (fila) {
        console.log("Fila seleccionada:", fila);
        for (const campo in campos) {
          const id = campos[campo];
          const input = document.getElementById(id);
          if (input) {
            input.value = fila[campo] !== undefined ? fila[campo] : '';
          }
        }
      } else {
        for (const campo in campos) {
          if (campo !== 'numeroNegocio') {
            const input = document.getElementById(campos[campo]);
            if (input) input.value = '';
          }
        }
      }
    }
    
    inputNegocio.addEventListener("change", cargarDatosGrupo);
    inputNegocio.addEventListener("input", cargarDatosGrupo);

  }
    
     // Funci√≥n para guardar y volver
    function guardarYVolver() {
      guardarDatos(false); // <- esta funci√≥n se conectar√° con Excel Online
      setTimeout(() => {
        window.history.back();
      }, 1000);
    }

  cargarNumeroNegocio();
</script>

</body>
</html>
